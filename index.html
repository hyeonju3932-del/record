<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>ì¬ë¯¼ì´ì™€ ë°œìŒ ë¹„êµí•˜ê¸°</title>
<style>
 body {
   font-family: "Pretendard", sans-serif;
   background: #fff7d1;
   margin: 0; padding: 0;
   display: flex; flex-direction: column;
   align-items: center;
   padding: 20px;
   text-align: center;
 }
 h1 {
   font-size: 24px;
   font-weight: 700;
   margin-bottom: 10px;
 }
 .character-box {
   text-align: center;
   margin-bottom: 20px;
 }
 .section {
   background: #ffffff;
   width: 100%; max-width: 420px;
   border-radius: 20px;
   padding: 20px;
   box-shadow: 0 4px 10px rgba(0,0,0,0.1);
   margin-bottom: 25px;
 }
 button {
   background: #ffd54f;
   border: none;
   padding: 12px 20px;
   border-radius: 12px;
   font-size: 16px;
   cursor: pointer;
   display: inline-block;
   margin: 5px;
 }
 button:hover {
   background: #ffca28;
 }
 .result-box {
   margin-top: 15px;
   background: #fff3c4;
   padding: 15px;
   border-radius: 14px;
   text-align: center;
   font-size: 18px;
   font-weight: 600;
 }
 .emoji {
   font-size: 22px;
   margin-right: 6px;
 }
</style>
</head>
<body>
<h1>1. ì•„, ì–´, ì˜¤, ìš°, ìœ¼, ì´</h1>

<div class="character-box">
 <img src="robot-character.png" alt="ì¬ë¯¼" width="180" />
 <p>ë„¤ê°€ ë§í•œ ì†Œë¦¬ê°€ ë§ëŠ”ì§€ ë“¤ì–´ë³´ê³  ì•Œë ¤ì¤„ê²Œ!</p>
</div>

<div class="section">
 <h2>ë¹„êµí•˜ê¸°</h2>
 <p>ë¬¸ì¥ì„ ì„ íƒí•˜ê³  ëª¨ë²” ë°œìŒì„ ë“¤ì–´ë³´ì„¸ìš”.</p>

 <select id="sentenceSelect" onchange="setSentence()" style="padding:8px; font-size:16px; border-radius:8px; margin-bottom:15px;">
   <option value="">ë¬¸ì¥ ì„ íƒ</option>
   <option value="1">1. ì•„ë¹ ê°€ ìš°ì‚°ì„ ì¨ìš”.</option>
   <option value="2">2. ì•„ê¸°ê°€ ìš°ìœ ë¥¼ ë¨¹ì–´ìš”.</option>
   <option value="3">3. ì–´ë¨¸ë‹ˆê°€ ì•„ì´ì™€ ë†€ì•„ìš”.</option>
   <option value="4">4. ì˜¤ë¹ ê°€ ì•„ì´ìŠ¤í¬ë¦¼ì„ ì‚¬ìš”.</option>
 </select>

 <audio id="baseAudioPlayer" controls style="margin-bottom:12px;"></audio>
 <br /></h2>
 <p>ëª¨ë²” ë°œìŒê³¼ ë‚´ ë°œìŒì„ í•¨ê»˜ ë“¤ì–´ë³´ì„¸ìš”.</p>
 <audio id="baseAudioPlayer" controls style="margin-bottom:12px;"></audio>
 <br /></h2>
 <button onclick="compareSound()">ê²°ê³¼ ë³´ê¸°</button>
 <div id="result" class="result-box">ì•„ì§ ë¹„êµ ì „ì…ë‹ˆë‹¤.</div>
</div>

<script>
let baseAudio = new Audio();
let mediaRecorder;
let chunks = [];
let currentVowel = null;

const baseSentences = {
  1: 'base_sentence_1.mp3',
  2: 'base_sentence_2.mp3',
  3: 'base_sentence_3.mp3',
  4: 'base_sentence_4.mp3'
};

const baseData = {
  a: { len: 600 },
  eo: { len: 620 },
  o: { len: 550 },
  u: { len: 580 },
  eu: { len: 500 },
  i: { len: 520 }
};

function playBase(v) {
  currentVowel = v;
  const src = `base_${v}.mp3`;
  baseAudio.src = src;
  document.getElementById('baseAudioPlayer').src = src;
  baseAudio.play();
}

function setSentence() {
  const num = document.getElementById('sentenceSelect').value;
  if (!num) return;
  const audioSrc = baseSentences[num];
  document.getElementById('baseAudioPlayer').src = audioSrc;
}(v) {
  currentVowel = v;
  const src = `base_${v}.mp3`;
  baseAudio.src = src;
  document.getElementById('baseAudioPlayer').src = src;
  baseAudio.play();
}(v) {
  currentVowel = v;
  baseAudio.src = `base_${v}.mp3`;
  baseAudio.play();
}

function startRec() {
  if (navigator.mediaDevices && navigator.mediaDevices.getUserMedia) {
    navigator.mediaDevices.getUserMedia({ audio: true }).then(stream => {
      mediaRecorder = new MediaRecorder(stream);
      chunks = [];
      mediaRecorder.ondataavailable = e => chunks.push(e.data);
      mediaRecorder.onstop = e => {
        const blob = new Blob(chunks, { type: 'audio/ogg; codecs=opus' });
        const url = URL.createObjectURL(blob);
        document.getElementById('userAudio').src = url;
      };
      mediaRecorder.start();
    }).catch(err => {
      alert('ë§ˆì´í¬ ì ‘ê·¼ì´ ì°¨ë‹¨ë˜ì—ˆìŠµë‹ˆë‹¤. ë¸Œë¼ìš°ì € ì„¤ì •ì„ í™•ì¸í•˜ì„¸ìš”.');
    });
  } else {
    alert('ì´ ë¸Œë¼ìš°ì €ëŠ” ë…¹ìŒì„ ì§€ì›í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.');
  }
}

function stopRec() {
  if (mediaRecorder && mediaRecorder.state !== "inactive") mediaRecorder.stop();
}

function compareSound() {
  if (!currentVowel) {
    document.getElementById('result').innerHTML = 'ê¸°ì¤€ ìŒì„±ì„ ë¨¼ì € ì„ íƒí•˜ì„¸ìš”.';
    return;
  }

  const baseLen = baseData[currentVowel].len;
  const userLen = Math.floor(Math.random() * 300) + 400;
  const diff = Math.abs(baseLen - userLen) / baseLen * 100;

  let resultText = '';
  if (diff > 20) resultText = '<span class="emoji">ğŸ˜•</span>ë‹¬ë¼';
  else if (diff > 5) resultText = '<span class="emoji">ğŸ™‚</span>ë¹„ìŠ·í•´';
  else resultText = '<span class="emoji">ğŸ˜„</span>ì •í™•í•´';

  document.getElementById('result').innerHTML = resultText;
}
</script>
</body>
</html>
